{% extends "base.html" %}
{% block head %}
  {% include "user/chatui/chatui_css.html" %}
{% endblock %}
{% block content %}
  {% set reply_as_user = topic.data.get('target_user') %}
  <section style="background-color: #eee;">
    {% if not focus_mode %}
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="../..">All chats</a></li>
          <li class="breadcrumb-item active" aria-current="page">{{ thread.id }}</li>
        </ol>
      </nav>
    {% endif %}
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-5 col-lg-6 col-xl-7 border-left border-right">
          {% if reply_as_user %}
            <div class="alert alert-info p-1 text-center"> You are replying as <b>Speaker
              {{ reply_as_user }}</b></div>
          {% endif %}

          <ul id="chat-thread" class="list-unstyled" style="overflow-y:scroll; max-height: 800px;"></ul>
          <form id="next_msg_form" class="form" action="#" method="POST">
            <div class="form-group basic-textarea" style="display: flex">
                        <textarea id="next_msg_text" class="form-control pl-2 my-0" rows="2"
                                  placeholder="Type your message here..."></textarea>
              <div class="my-1">
                <input type="submit" class="btn btn-primary mx-2" id='send_btn' value="Send" type="submit"/>
              </div>
            </div>
          </form>
          <div id="waiting_info" class="text-center alert alert-primary" style="display: none;">
            Waiting for response from moderator or other user...
            <span class="dot one">⦿</span>
            <span class="dot two">⦿</span>
            <span class="dot three">⦿</span>
          </div>

          <div id="end_info" class="p-4 alert alert-info">
            Thanks for participating in the chat! Please submit your ratings to complete this task and receive
            compensation.
          </div>
        </div>
        <!-- hide this block when more turns to go; but show this to admin regardless -->
        <div class="col-md-7 col-lg-6 col-xl-5 mb-4 border-right border-left">
          {{ simple_instructions_html |safe }}
          <div> Your remaining turns: <code><span id="remaining-turns-count">{{ remaining_turns }} </span> </code></div>

          {% if instructions_html %}
            <button type="button" class="btn btn-info my-3" data-toggle="modal"
                    data-target="#instructionsmodal">Detailed Instructions
            </button>
          {% endif %}

          {% include "user/chatui/chatui_final_survey.html" %}


        </div>
      </div>
    </div>

    {% include "user/chatui/chatui_js.html" %}
  </section>

  {% if instructions_html %}
    <div class="modal fade" id="instructionsmodal" data-backdrop="static" data-keyboard="false" tabindex="-1"
         aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Instructions</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            {{ instructions_html |safe }}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}